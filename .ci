use_docker
base jenkins:base
require nginx php5-fpm php5-mysql rrdtool
target /opt/librenms
ports 80
-- /etc/nginx/sites-available/default
+ server {
+  listen 80;
+  server_name _;
+  root        /opt/librenms/html;
+  index       index.php;
+  access_log  /opt/librenms/logs/access_log;
+  error_log   /opt/librenms/logs/error_log;
+  location / {
+   disable_symlinks off;
+   try_files $uri $uri/ @librenms;
+  }
+  location ~ \.php {
+   include fastcgi_params;
+   fastcgi_split_path_info ^(.+\.php)(/.+)$;
+   fastcgi_pass unix:/var/run/php5-fpm.sock;
+  }
+  location ~ /\.ht {
+   deny all;
+  }
+  location @librenms {
+   rewrite ^api/v0(.*)$ /api_v0.php/$1 last;
+   rewrite ^(.+)$ /index.php/$1 last;
+  }
+ }
--
-- /opt/librenms/config.php
+ <?php
+ $config['db_host'] = "%MYSQL_HOST";
+ $config['db_user'] = "%MYSQL_USER";
+ $config['db_pass'] = "%MYSQL_PASSWORD";
+ $config['db_name'] = "%MYSQL_DATABASE";
--
